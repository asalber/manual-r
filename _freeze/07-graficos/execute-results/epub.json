{
  "hash": "718036ab07d45540b43365eb5485ca51",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Gráficos y visualización de datos\nlang: es\n---\n\nR incorpora funciones para realizar gráficos de distintos tipos, pero actualmente existen paquetes especializados para la visualización de datos como `ggplot2` que permiten realizar multitud de gráficos de manera más estructurada.\n\n## Gramática de gráficos y el paquete `ggplot2`\n\nEl paquete [`ggplot2`](https://ggplot2.tidyverse.org/) forma parte de la colección de paquetes `tidyverse` que ya se introdujo en la sección anterior. \n\nEste paquete implementa la [gramática de gráficos](https://www.academia.edu/54823545/The_grammar_of_graphics) descrita por Leland Wilkinson, que proporciona un sistema formal para representar distintas variables mediante distintos atributos gráficos (aesthetics) como la forma, el tamaño o el color de objetos geométricos como puntos, líneas o barras. Esto hace que la creación de gráficos con este paquete sea, en general, más intuitiva una vez se entiende la lógica de la gramática. \n\nEn general, para definir un gráfico con `ggplot2` se suelen definir los siguientes elementos:\n\n- **Datos**. Los datos deben estar contenidos en un data frame o tibble en formato ordenado (_tidy_).\n- **Atributos (_aesthetics_)**. Las variables que quieren representarse en el gráfico deben asociarse a atributos gráficos como los ejes x, y, z, el color, el tamaño, la forma de los objetos geométricos.\n- **Capas de objetos geométricos (_geoms_)**. Están formadas por elementos geométricos (puntos, líneas, barras, etc.) cuya posición, forma, tamaño y color, depende de los atributos. \n- **Escalas**. Definen la escala para los ejes del diagrama así como las leyendas para el resto de atributos.\n- **Sistema de coordenadas**. Describe el sistema de coordenadas utilizado para representar los objetos geométricos en el plano o en el espacio (normalmente el sistema cartesiano).\n- **Facetas**. Permite descomponer un gráfico en múltiples gráficos para distintos subconjuntos del conjunto de datos.\n- **Tema**. Permite cambiar elementos secundarios del gráfico como el tipo de letra de las etiquetas y leyendas, el tamaño de la fuente, el color de fondo, aspecto final del los gráficos.\n\n![Gramática de gráficos de ggplot2](img/graficos/ggplot-grammar-of-graphics.png)\n\nEstos elementos se suelen añadir por capas al gráfico mediante el operador `+`.\n\n## Inicialización de un gráfico\n\nPara dibujar un gráfico con `ggplot2` debemos comenzar por la siguiente función\n\n- `ggplot(df, aes(atributo1 = var1, atributo2 = var2, ...))`: Inicializa un gráfico con las variables `var1`, `var2`, etc. del data frame `df` asociadas a los atributos `atributo1`, `atributo2`, etc. respectivamente. Los atributos pueden más comunes son:\n    - x: Posición en el eje x del objeto geométrico.\n    - y: Posición en el eje y del objeto geométrico.\n    - z: Posición en el eje z del objeto geométrico.\n    - shape: Forma del punto.\n    - size: Tamaño del punto.\n    - linetype: Forma de la línea.\n    - linewidth: Anchura de la línea.\n    - colour: Color del objeto geométrico.\n    - fill: Color de relleno del objeto geométrico.\n\n\n:::{.callout-important}\nTodos los atributos se indican dentro de la función `aes()`.\n:::\n\n## Diagramas de puntos\n\nPara dibujar un diagrama de puntos se utiliza la capa de objetos geométricos\n\n- `geom_point()`: Dibuja un diagrama de líneas que unen los puntos con coordenadas dadas por los pares de valores de las variables asociadas a los atributos `x` e `y`. \n\nEsta capa es ideal para representar diagramas de dispersión.\n\n:::{#exm-puntos-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/temperaturas.csv') %>%\n    mutate(Día = factor(Día, levels = c(\"L\", \"M\", \"X\", \"J\", \"V\", \"S\", \"D\")))\n# Filtrar los datos de Madrid\ndf.madrid = filter(df, Ciudad == \"Madrid\")\n# Inicializar el gráfico con el día en el atributo x y la temperatura en el atributo y.\nggplot(df.madrid, aes(x = Día, y = Temperatura)) +\n# Añadir la capa de los puntos.\n    geom_point()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-1-1.png)\n:::\n:::\n:::\n\n:::{#exm-puntos-2}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con el día en el atributo x, la temperatura en el atributo y, y la ciudad en el atributo shape.\nggplot(df, aes(x = Día, y = Temperatura, shape = Ciudad)) +\n# Añadir la capa de los puntos.\n    geom_point()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-2-1.png)\n:::\n:::\n:::\n\n:::{#exm-puntos-3}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con el día en el atributo x, la temperatura en el atributo y, y la ciudad en el atributo colour.\nggplot(df, aes(x = Día, y = Temperatura, colour = Ciudad)) +\n# Añadir la capa de los puntos.\n    geom_point()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-3-1.png)\n:::\n:::\n:::\n\n:::{#exm-puntos-4}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/colesterol.csv')\n# Inicializar el gráfico con la altura en el atributo x y el peso en el atributo y.\nggplot(df, aes(x = altura, y = peso)) +\n# Añadir la capa de los puntos.\n    geom_point()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-4-1.png)\n:::\n:::\n:::\n\n:::{#exm-puntos-5}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con la altura en el atributo x, el peso en el atributo y, y el sexo en el atributo colour.\nggplot(df, aes(x = altura, y = peso, colour = sexo)) +\n# Añadir la capa de los puntos.\n    geom_point()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-5-1.png)\n:::\n:::\n:::\n\n[Más información sobre `geom_point`](https://ggplot2.tidyverse.org/reference/geom_point.html).\n\n## Diagramas de líneas\n\nPara dibujar un diagrama de líneas se utiliza la capa de objetos geométricos\n\n- `geom_line()`: Dibuja un diagrama de líneas que unen los puntos con coordenadas dadas por los pares de valores de las variables asociadas a los atributos `x`\ne `y`. Cuando la variable asociada al atributo `x` es un factor, debe asociarse también una variable al atributo `group` para determina los grupos que se unirán mediante líneas. Si solo hay un grupo debe indicarse `group = 1`. \n\nEsta capa es ideal para representar series temporales.\n\n:::{#exm-lineas-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/temperaturas.csv') %>%\n    mutate(Día = factor(Día, levels = c(\"L\", \"M\", \"X\", \"J\", \"V\", \"S\", \"D\")))\n# Filtrar los datos de Madrid\ndf.madrid = filter(df, Ciudad == \"Madrid\")\n# Inicializar el gráfico con el día en el atributo x y la temperatura en el atributo y. \nggplot(df.madrid, aes(x = Día, y = Temperatura, group = 1)) +\n# Añadir la capa de las lineas.\n    geom_line()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-6-1.png)\n:::\n:::\n:::\n\n:::{#exm-lineas-2}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con el día en el atributo x, la temperatura en el atributo y, y la ciudad en los atributos group y linetype.\nggplot(df, aes(x = Día, y = Temperatura, group = Ciudad, linetype = Ciudad)) +\n# Añadir la capa de las lineas.\n    geom_line()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-7-1.png)\n:::\n:::\n:::\n\n:::{#exm-lineas-3}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con el día en el atributo x, la temperatura en el atributo y, y la ciudad en los atributos group y colour.\nggplot(df, aes(x = Día, y = Temperatura, group = Ciudad, colour = Ciudad)) +\n# Añadir la capa de las lineas.\n    geom_line()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-8-1.png)\n:::\n:::\n:::\n\n[Más información sobre `geom_line`](https://ggplot2.tidyverse.org/reference/geom_path.html).\n\n## Diagramas de barras\n\nPara dibujar un diagrama de barras se utiliza la capa de objetos geométricos\n\n- `geom_bar(aes(weight = var))`: Dibuja un diagrama de barras con la variable asociada al atributo `x` o `y` (si se usa el atributo `x` las barras son verticales y se usa `y` horizontales), donde la altura de las barras viene dada por la variable `var`. Si no se indica   Por defecto, la altura de las barras representa la frecuencia absoluta de cada valor de la variable. Si no se indica el atributo `weight` la altura de las barras es la frecuencia absoluta de los valores de la variable asociada a los atributos `x` o `y`.\n\n:::{#exm-barras-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/temperaturas.csv') %>%\n    mutate(Día = factor(Día, levels = c(\"L\", \"M\", \"X\", \"J\", \"V\", \"S\", \"D\")))\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Ciudad Día Temperatura\n1     Madrid   L        28.5\n2     Madrid   M        30.5\n3     Madrid   X        31.0\n4     Madrid   J        30.0\n5     Madrid   V        28.0\n6     Madrid   S        27.5\n7     Madrid   D        30.5\n8  Barcelona   L        24.5\n9  Barcelona   M        25.5\n10 Barcelona   X        26.5\n11 Barcelona   J        25.0\n12 Barcelona   V        26.5\n13 Barcelona   S        24.5\n14 Barcelona   D        25.0\n```\n\n\n:::\n\n```{.r .cell-code}\n# Filtrar los datos de Madrid\ndf.madrid = filter(df, Ciudad == \"Madrid\")\n# Inicializar el gráfico con el día en el atributo x.\nggplot(df.madrid, aes(x = Día)) +\n# Añadir la capa de las barras con altura la temperatura.\n    geom_bar(aes(weight = Temperatura))\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-9-1.png)\n:::\n:::\n:::\n\n:::{#exm-barras-2}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con el día en el atributo y.\nggplot(df.madrid, aes(y = Día)) +\n# Añadir la capa de las barras con altura la temperatura.\n    geom_bar(aes(weight = Temperatura))\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-10-1.png)\n:::\n:::\n:::\n\n:::{#exm-barras-3}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con el día en el atributo x y la ciudad en el color de relleno.\nggplot(df, aes(x = Día, fill = Ciudad)) +\n# Añadir la capa de las barras con altura la temperatura (por defecto barras acumuladas).\n    geom_bar(aes(weight = Temperatura))\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-11-1.png)\n:::\n:::\n:::\n\n:::{#exm-barras-4}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con el día en el atributo x y la ciudad en el color de relleno.\nggplot(df, aes(x = Día, fill = Ciudad)) +\n# Añadir la capa de las barras con altura la temperatura indicando barras separadas.\n    geom_bar(aes(weight = Temperatura), position = \"dodge\")\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-12-1.png)\n:::\n:::\n:::\n\n:::{#exm-barras-5}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/colesterol.csv')\n# Inicializar el gráfico con el sexo en el atributo x.\nggplot(df, aes(x = sexo)) +\n# Añadir la capa de las barras.\n    geom_bar()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-13-1.png)\n:::\n:::\n:::\n\n:::{#exm-barras-6}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con el sexo en los atributos x y fill.\nggplot(df, aes(x = sexo, fill = sexo)) +\n# Añadir la capa de las barras.\n    geom_bar() \n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-14-1.png)\n:::\n:::\n:::\n\n\n:::{#exm-barras-7}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con el sexo en los atributos x y fill.\nggplot(df, aes(x = sexo, fill = sexo)) +\n# Añadir la capa de las barras con frecuencias relativas.\n     geom_bar(aes(y = after_stat(count / sum(count) * 100))) +\n# Cambiamos la etiqueta del eje y\nlabs(y = \"Porcentaje (%)\")\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-15-1.png)\n:::\n:::\n:::\n\n[Más información sobre `geom_bar`](https://ggplot2.tidyverse.org/reference/geom_bar.html).\n\n## Histogramas\n\nPara dibujar un histograma se utiliza la capa de objetos geométricos\n\n- `geom_histogram(bins = clases, binwidth = anchura)`: Dibuja un histograma de la variable asociada al atributo `x` usando el número de clases indicado por `clases` o bien clases de amplitud indicada por `anchura`. Si no se indica el parámetro `bins` o `bindwidth` se toman 30 clases por defecto.\n\n:::{#exm-histograma-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/colesterol.csv')\n# Inicializar el gráfico con la edad en el atributo x.\nggplot(df, aes(x = altura)) +\n# Añadir la capa del histograma.\n    geom_histogram()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-16-1.png)\n:::\n:::\n:::\n\n:::{#exm-histograma-2}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con la edad en el atributo x.\nggplot(df, aes(x = altura)) +\n# Añadir la capa del histograma con anchura de clases 5.\n    geom_histogram(binwidth = 0.1)\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-17-1.png)\n:::\n:::\n:::\n\n:::{#exm-histograma-3}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con la edad en el atributo x y el sexo en el atributo fill.\nggplot(df, aes(x = altura, fill = sexo)) +\n# Añadir la capa del histograma con anchura de clases 10.\n    geom_histogram(binwidth = 0.1)\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-18-1.png)\n:::\n:::\n:::\n\n:::{#exm-histograma-3}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con la edad en el atributo x y el sexo en el atributo fill.\nggplot(df, aes(x = altura, fill = sexo)) +\n# Añadir la capa del histograma con anchura de clases 10.\n    geom_histogram(binwidth = 0.1,alpha=0.4, position=\"identity\")\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-19-1.png)\n:::\n:::\n:::\n\n[Más información sobre `geom_histogram`](https://ggplot2.tidyverse.org/reference/geom_histogram.html).\n\n## Diagramas de densidad\n\nPara dibujar un diagrama de densidad se utiliza la capa de objetos geométricos\n\n- `geom_density()`: Dibuja un diagrama de densidad de probabilidad estimada de los valores de la variable asociada al atributo `x`.\n\nEste diagrama es una alternativa a los histogramas para representar la distribución de probabilidad de los valores de una variable.\n\n:::{#exm-densidad-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/colesterol.csv')\n# Inicializar el gráfico con la edad en el atributo x.\nggplot(df, aes(x = edad)) +\n# Añadir la capa de la densidad de probabilidad.\n    geom_density()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-20-1.png)\n:::\n:::\n:::\n\n:::{#exm-densidad-2}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con la edad en el atributo x y el sexo en el atributo colour.\nggplot(df, aes(x = edad, colour = sexo)) +\n# Añadir la capa de la densidad de probabilidad.\n    geom_density()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-21-1.png)\n:::\n:::\n:::\n\n[Más información sobre `geom_density`](https://ggplot2.tidyverse.org/reference/geom_density.html).\n\n## Diagramas de cajas\n\nPara dibujar un diagrama de caja y bigotes se utiliza la capa de objetos geométricos\n\n- `geom_boxplot()`: Dibuja un diagrama de caja y bigotes de la variable asociada al atributo `x` o `y`. Si se utiliza el atributo `x` la caja se representa horizontalmente, y si se utiliza el atributo `y` verticalmente.\n\n:::{#exm-cajas-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/colesterol.csv')\n# Inicializar el gráfico con el colesterol en el atributo x.\nggplot(df, aes(x = colesterol)) +\n# Añadir la capa de la caja.\n    geom_boxplot()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1 row containing non-finite outside the scale range\n(`stat_boxplot()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-22-1.png)\n:::\n:::\n:::\n\n:::{#exm-cajas-2}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con la altura en el atributo y y el sexo en el atributo fill.\nggplot(df, aes(y = altura, fill = sexo)) +\n# Añadir la capa de la caja.\n    geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-23-1.png)\n:::\n:::\n:::\n\n[Más información sobre `geom_boxplot`](https://ggplot2.tidyverse.org/reference/geom_boxplot.html).\n\n## Diagrama de sectores\n\nPara dibujar un diagrama de sectores se utiliza la misma capa de objetos geométricos que para los diagramas de barras (`geom_bar`) pero añadiendo el sistema de coordenadas polares.\n\n- `coor_polar(theta = \"x\"|\"y\")`: Cambia al sistema de coordenadas cartesianas polares, donde el ángulo viene dado por la variable asociada al atributo \"x\" o el atributo \"y\".\n\n:::{#exm-sectores-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/colesterol.csv')\n# Inicializar el gráfico con el sexo en el atributo x.\nggplot(df, aes(x = \"\", fill = sexo)) +\n# Añadir la capa de las barras.\n    geom_bar() +\n# Añadir el sistema de coordenadas polares\n    coord_polar(theta = \"y\")\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-24-1.png)\n:::\n:::\n:::\n\n## Interpolación y ajustes de regresión\n\nPara dibujar una línea de interpolación o de ajuste de regresión se utiliza la capa de objetos geométricos\n\n- `geom_smooth(method = ajuste, formula = ecuación)`: Dibuja una línea de ajuste para los puntos con coordenadas dadas por los pares de valores de las variables asociadas a los atributos `x` e `y`, usando el método de ajuste dado por por `ajuste` y la fórmula dada por `ecuación`. Los métodos de ajuste más habituales son:\n    - [`\"loess\"`](https://rdrr.io/r/stats/loess.html): Ajuste de regresión polinomial local. Es la que se utiliza por defecto.\n    - [`\"lm\"`](https://rdrr.io/r/stats/lm.html): Ajuste de regresión de modelos lineal por mínimos cuadrados.\n    - [`\"glm\"`](https://rdrr.io/r/stats/glm.html): Ajuste de regresión modelos lineales generalizados por mínimos cuadrados.\nPor defecto se dibujan también las bandas con el error estándar del ajuste. Para desactivar estas bandas se debe indicar también el parámetro `se = FALSE`.\n\nEsta capa suele usarse en combinación con la capa de puntos para diagramas de dispersión.\n\n:::{#exm-ajuste-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/colesterol.csv')\n# Inicializar el gráfico con la altura en el atributo x y el peso en el atributo y.\nggplot(df, aes(x = altura, y = peso)) +\n# Añadir la capa de puntos.\n    geom_point() +\n# Añadir la capa de ajuste de regresión polinomial local loess\n    geom_smooth()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-25-1.png)\n:::\n:::\n:::\n\n:::{#exm-ajuste-2}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con la altura en el atributo x y el peso en el atributo y.\nggplot(df, aes(x = altura, y = peso)) +\n# Añadir la capa de puntos.\n    geom_point() +\n# Añadir la capa de ajuste de regresión lineal por mínimos cuadrados.\n    geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-26-1.png)\n:::\n:::\n:::\n\n:::{#exm-ajuste-3}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con la altura en el atributo x, el peso en el atributo y, y el sexo en el atributo colour.\nggplot(df, aes(x = altura, y = peso, colour = sexo)) +\n# Añadir la capa de puntos.\n    geom_point() +\n# Añadir la capa de ajuste de regresión lineal por mínimos cuadrados sin las bandas de error.\n    geom_smooth(method = \"lm\", se = FALSE)\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-27-1.png)\n:::\n:::\n:::\n\n[Más información sobre `geom_smooth`](https://ggplot2.tidyverse.org/reference/geom_smooth.html).\n\n## Facetas\n\nLas facetas permiten desagregar un gráfico según los grupos de uno o varios factores del conjunto de datos. Para añadir facetas a un gráfico se añade la función \n\n- `facet_wrap(vars(var1, var2,...), nrow = n, ncol = m)`: Crea un un gráfico para cada combinación de valores de las variables `var1`, `var2`, etc. y los coloca en una tabla de `n` filas y `m` columnas.\n\n:::{#exm-facetas-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/colesterol.csv')\n# Inicializar el gráfico con la altura en el atributo x y el peso en el atributo y.\nggplot(df, aes(x = altura, y = peso)) +\n# Añadir la capa de puntos\n    geom_point() +\n# Añadir la capa de ajuste de regresión lineal por mínimos cuadrados.\n    geom_smooth(method = \"lm\") +\n# Añadir la faceta del sexo.\n    facet_wrap(vars(sexo))\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-28-1.png)\n:::\n:::\n:::\n\n[Más información sobre facetas](https://ggplot2.tidyverse.org/reference/facet_wrap.html?q=facet_wrap).\n\n## Personalización de gráficos\n\n`ggplot` incluye multitud de posibilidades de personalización de gráficos. Aquí veremos solo las más habituales.\n\n### Títulos\n\nPara poner un título al gráfico, a los ejes o a la leyenda se añade la función \n\n- `labs(title = título, x = titulo-x, y = titulo-y,`  \n    `colour = leyenda-color, shape  = leyenda-forma)`\n\n:::{#exm-titulos-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/colesterol.csv')\n# Inicializar el gráfico con la altura en el atributo x y el peso en el atributo y.\nggplot(df, aes(x = altura, y = peso)) +\n# Añadir la capa de puntos.\n    geom_point() +\n# Añadir un título al gráfico y a los ejes.\n    labs(title = \"Diagrama de dispersión\", x = \"Altura (m)\", y = \"Peso (kg)\")\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-29-1.png)\n:::\n:::\n:::\n\n### Escalas\n\nPara cambiar las escalas de los ejes cartesianos se añaden la funciones\n\n- `scale_x_continuos(limits = rango, breaks = cortes, labels = etiquetas, trans = transformación)`: Restringe escala del eje x al rango indicado por `rango`, incluye las marcas en eje indicadas por `cortes` con las etiquetas indicadas por `etiquetas` y aplica la transformación de escala indicada por `transformación`. Las transformaciones de escala más habituales son `\"log2\"` (logarítmo en base 2), `\"log10\"` (logarítmo en base 10) y `sqrt` (raíz cuadrada).\n\n- `scale_y_continuos(limits = rango, breaks = cortes, labels = etiquetas, trans = transformación)`: Igual que la función anterior pero para el eje y.\n\n:::{#exm-escalas-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/colesterol.csv')\n# Inicializar el gráfico con la altura en el atributo x y el peso en el atributo y.\nggplot(df, aes(x = altura, y = peso)) +\n# Añadir la capa de los puntos.\n    geom_point() +\n# Cambiar el rango y las marcas de la escala del eje x\n    scale_x_continuous(limits = c(1.5, 2.1), breaks = seq(1.5, 2.1, 0.1)) +\n# Aplicar una transformación logarítmica a la la escala del eje y\n    scale_y_continuous(trans = \"log2\", breaks = seq(50, 110, 10))\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-30-1.png)\n:::\n:::\n:::\n\n### Temas\n\nFinalmente se para cambiar otros aspectos del gráfico como las fuentes o los colores de fondos se utilizan temas. Para indicar o modificar un tema se añade la función\n\n- `theme(propiedades)`: Modifica las propiedades del tema indicadas. La lista es demasiado grande para cubrirla en este tutorial, por lo que se recomienda ver todas las opciones en la documentación de `ggplot2`.\n\n:::{#exm-temas-1}\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ndf <- read.csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/colesterol.csv')\n# Inicializar el gráfico con la altura en el atributo x y el peso en el atributo y.\nggplot(df, aes(x = altura, y = peso)) +\n# Añadir la capa de puntos.\n    geom_point() +\n# Añadir un título al gráfico.\n    labs(title = \"Diagrama de dispersión\") +\n# Cambiar el tamaño y el color de la fuente del título.\n    theme(plot.title = element_text(size = 20, colour = \"blue\"))\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-31-1.png)\n:::\n:::\n:::\n\n:::{#exm-temas-2}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con la altura en el atributo x, el peso en el atributo y, y el sexo al atributo colour.\nggplot(df, aes(x = altura, y = peso, colour = sexo)) +\n# Añadir la capa de puntos.\n    geom_point() +\n# Cambiar el la posición de la leyenda\n    theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-32-1.png)\n:::\n:::\n:::\n\n[Más información sobre temas](https://ggplot2.tidyverse.org/reference/theme.html).\n\n`ggplot2` incorpora los siguientes temas predefinidos:\n\n    - `theme_gray()`: Tema en escala de grises. Es el tema por defecto.\n    - `theme_bw()`: Tema en blanco y negro.\n    - `theme_light()`: Tema con las líneas de los ejes y de la rejilla delgadas y atenuadas para dar más protagonismo a los datos.\n    - `theme_dark()`: Similar al tema anterior pero con fondo oscuro.\n    - `theme_minimal()`: Tema sin fondo.\n    - `theme_classic()`: Tema sin rejilla.\n    - `theme_void()`: Tema vacío.\n\n:::{#exm-temas-3}\n::: {.cell}\n\n```{.r .cell-code}\n# Inicializar el gráfico con la altura en el atributo x, el peso en el atributo y, y el sexo al atributo colour.\nggplot(df, aes(x = altura, y = peso, colour = sexo)) +\n# Añadir la capa de puntos.\n    geom_point() +\n# Usar el tema sin rejilla\n    theme_classic()\n```\n\n::: {.cell-output-display}\n![](07-graficos_files/figure-epub/unnamed-chunk-33-1.png)\n:::\n:::\n:::\n\n## Ejercicios\n\n:::{#exr-graficos-1}\nEl fichero [neonatos](https://raw.githubusercontent.com/asalber/manual-r/master/datos/neonatos.csv) contiene información sobre los recién nacidos en un hospital durante un año.\n\na.  Crear un tibble con los datos del fichero. \n\n    :::{.callout-note collapse=\"true\"}\n    ## Solución \n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    library(tidyverse)\n    df <- read_csv('https://raw.githubusercontent.com/asalber/manual-r/master/datos/neonatos.csv')\n    df\n    ```\n    \n    ::: {.cell-output .cell-output-stdout}\n    \n    ```\n    # A tibble: 320 × 8\n        peso sexo   edad        tabaco cigarros tabaco.antes apgar1 apgar5\n       <dbl> <chr>  <chr>       <chr>     <dbl> <chr>         <dbl>  <dbl>\n     1  3.28 hombre mayor de 20 No            0 No                7      7\n     2  3.49 hombre mayor de 20 No            0 No                7      8\n     3  2.88 hombre mayor de 20 No            0 Si                5      6\n     4  3.42 hombre mayor de 20 No            0 No                8      8\n     5  3.31 hombre mayor de 20 No            0 No                6      7\n     6  3.53 hombre mayor de 20 No            0 No                8      8\n     7  3.46 hombre mayor de 20 No            0 No                7      8\n     8  3.12 hombre mayor de 20 No            0 No                7      7\n     9  2.77 hombre mayor de 20 No            0 No                5      5\n    10  3.31 hombre mayor de 20 No            0 No                7      8\n    # ℹ 310 more rows\n    ```\n    \n    \n    :::\n    :::\n    :::\n\na.  Convertir las variables `sexo`, `edad`, `tabaco` y `tabaco.antes` en factores.\n\n    :::{.callout-note collapse=\"true\"}\n    ## Solución \n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    df <- mutate(df, sexo = factor(sexo), edad = factor(edad), tabaco = factor(tabaco), tabaco.antes = factor(tabaco.antes))\n    ```\n    :::\n    :::\n\na.  Dibujar un diagrama de barras con la frecuencia de niños y niñas.\n\n    :::{.callout-note collapse=\"true\"}\n    ## Solución \n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(df, aes(x = sexo)) +\n        geom_bar()\n    ```\n    \n    ::: {.cell-output-display}\n    ![](07-graficos_files/figure-epub/unnamed-chunk-36-1.png)\n    :::\n    :::\n    :::\n\na.  Dibujar un diagrama de barras del `apgar1` de los neonatos de madres fumadoras y no fumadoras durante el embarazo.\n\n    :::{.callout-note collapse=\"true\"}\n    ## Solución \n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(df, aes(x = apgar1, fill = tabaco)) +\n        geom_bar(position = \"dodge\")\n    ```\n    \n    ::: {.cell-output-display}\n    ![](07-graficos_files/figure-epub/unnamed-chunk-37-1.png)\n    :::\n    :::\n    :::\n\na.  Dibujar un histograma acumulado del peso según el sexo con 10 clases.\n\n    :::{.callout-note collapse=\"true\"}\n    ## Solución \n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(df, aes(x = peso, fill = sexo)) +\n        geom_histogram(bins = 10)\n    ```\n    \n    ::: {.cell-output-display}\n    ![](07-graficos_files/figure-epub/unnamed-chunk-38-1.png)\n    :::\n    :::\n    :::\n\na.  Dibujar un gráfico de densidad de probabilidad del peso de los neonatos de madres fumadoras y no fumadoras durante el embarazo.\n\n    :::{.callout-note collapse=\"true\"}\n    ## Solución \n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(df, aes(x = peso, colour = tabaco)) +\n        geom_density()\n    ```\n    \n    ::: {.cell-output-display}\n    ![](07-graficos_files/figure-epub/unnamed-chunk-39-1.png)\n    :::\n    :::\n    :::\n\na.  Dibujar un diagrama de caja del peso de los recién nacidos según sexo y si la madre fumaba o no durante el embarazo.\n\n    :::{.callout-note collapse=\"true\"}\n    ## Solución \n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    ggplot(df, aes(x = sexo, y = peso, fill = tabaco)) +\n        geom_boxplot()\n    ```\n    \n    ::: {.cell-output-display}\n    ![](07-graficos_files/figure-epub/unnamed-chunk-40-1.png)\n    :::\n    :::\n    :::\n\na.  Dibujar un diagrama de dispersión del peso de los recién nacidos de madres fumadoras durante el embarazo, frente al número de cigarros que fumaban las madres. Incluir la recta de regresión.\n\n    :::{.callout-note collapse=\"true\"}\n    ## Solución \n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    df %>% \n        filter(tabaco == \"Si\") %>%\n        ggplot(aes(x = cigarros, y = peso)) +\n            geom_point() +\n            geom_smooth(method = \"lm\")\n    ```\n    \n    ::: {.cell-output .cell-output-stderr}\n    \n    ```\n    `geom_smooth()` using formula = 'y ~ x'\n    ```\n    \n    \n    :::\n    \n    ::: {.cell-output-display}\n    ![](07-graficos_files/figure-epub/unnamed-chunk-41-1.png)\n    :::\n    :::\n    :::\n\na.  Dibujar un diagrama de dispersión del peso de los recién nacidos de madres fumadoras durante el embarazo, frente al número de cigarros que fumaban las madres, separando por facetas según el sexo y la edad de la madre.\n\n    :::{.callout-note collapse=\"true\"}\n    ## Solución \n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    df %>% \n        filter(tabaco == \"Si\") %>%\n        ggplot(aes(x = cigarros, y = peso)) +\n            geom_point() +\n            geom_smooth(method = \"lm\") +\n            facet_wrap(vars(sexo, edad))\n    ```\n    \n    ::: {.cell-output .cell-output-stderr}\n    \n    ```\n    `geom_smooth()` using formula = 'y ~ x'\n    ```\n    \n    \n    :::\n    \n    ::: {.cell-output-display}\n    ![](07-graficos_files/figure-epub/unnamed-chunk-42-1.png)\n    :::\n    :::\n    :::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}